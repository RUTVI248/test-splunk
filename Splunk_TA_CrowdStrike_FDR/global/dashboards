[
{
"eai:data": "<?xml version=\"1.0\" ?>\n<view isDashboard=\"False\" template=\"Splunk_TA_CrowdStrike_FDR:/templates/base.html\" type=\"html\">\n    <label>Configuration</label>\n</view>",
"eai:type": "views",
"name": "configuration",
"owner": "nobody",
"sharing": "global"
},
{
"eai:data": "<?xml version=\"1.0\" ?>\n<view isDashboard=\"False\" template=\"Splunk_TA_CrowdStrike_FDR:/templates/base.html\" type=\"html\">\n    <label>Inputs</label>\n</view>",
"eai:type": "views",
"name": "inputs",
"owner": "nobody",
"sharing": "global"
},
{
"eai:data": "<dashboard version=\"1.1\">\n  <label>Monitoring</label>\n  <row>\n    <panel>\n      <title>SQS message by event type</title>\n      <chart>\n        <search>\n          <query>index=_internal sourcetype=\"crowdstrike_fdr_ta*\" \"is processing SQS messages:\" sqs_msg_action IN (ingest, skip)\n| eval kind=mvindex(split(sqs_msg_pathPrefix, \"/\"), -2)\n| timechart span=1h count by kind</query>\n          <earliest>0</earliest>\n          <latest></latest>\n          <sampleRatio>1</sampleRatio>\n        </search>\n        <option name=\"charting.axisLabelsX.majorLabelStyle.rotation\">0</option>\n        <option name=\"charting.axisTitleX.text\">Time</option>\n        <option name=\"charting.axisTitleX.visibility\">visible</option>\n        <option name=\"charting.axisTitleY.text\">SQS messages count</option>\n        <option name=\"charting.axisTitleY.visibility\">visible</option>\n        <option name=\"charting.chart.bubbleSizeBy\">area</option>\n        <option name=\"charting.chart.stackMode\">stacked</option>\n        <option name=\"charting.legend.placement\">top</option>\n      </chart>\n    </panel>\n    <panel>\n      <title>S3 located event files vs event files received in SQS notifications</title>\n      <chart>\n        <search>\n          <query>index=_internal sourcetype=\"crowdstrike_fdr_ta*\" \"FDR S3 bucket monitor, new event file detected:\"\n|  mvexpand fdr_event_file\n|  eval s3_resource=\"s3://\"+fdr_bucket+\"/\" + fdr_event_file\n|  dedup s3_resource\n|  table fdr_event_file_last_modified s3_resource s3_kind| join type=outer left=s3 right=sqs where s3.s3_resource = sqs.s3_resource [search index=_internal sourcetype=\"crowdstrike_fdr_ta*\" \"is processing SQS messages:\" sqs_msg_fileList=*\n    |  eval fdr_event_file = split(sqs_msg_fileList, \",\")\n    |  mvexpand fdr_event_file\n    |  eval s3_resource=\"s3://\"+sqs_msg_bucket+\"/\" + fdr_event_file\n    |  dedup s3_resource\n    |  fields s3_resource]\n|  rename s3.fdr_event_file_last_modified as fdr_event_file_last_modified s3.s3_resource as s3_resource sqs.s3_resource as sqs_resource\n|  eval kind=mvindex(split(s3_resource, \"/\"), -3)\n| eval notify_action = if(isnull(sqs_resource), \"Missed\", \"Notified\")\n| eval action_by_kind = notify_action + \" \" + kind\n| eval missed_or_notified = if(isnull(sqs_resource), -1, 1)\n| eval _time = strptime(fdr_event_file_last_modified, \"%Y-%m-%d %H:%M:%S%z\")\n| table _time s3_resource sqs_resource fdr_event_file_last_modified action_by_kind missed_or_notified\n| timechart sum(missed_or_notified) by action_by_kind</query>\n          <earliest>-14d@d</earliest>\n          <latest>now</latest>\n          <sampleRatio>1</sampleRatio>\n        </search>\n        <option name=\"charting.axisTitleX.text\">Time</option>\n        <option name=\"charting.axisTitleX.visibility\">visible</option>\n        <option name=\"charting.axisTitleY.visibility\">visible</option>\n        <option name=\"charting.axisX.scale\">linear</option>\n        <option name=\"charting.axisY.scale\">linear</option>\n        <option name=\"charting.chart\">column</option>\n        <option name=\"charting.legend.placement\">top</option>\n      </chart>\n    </panel>\n  </row>\n  <row>\n    <panel>\n      <title>Bucket resources ingest by stage</title>\n      <chart>\n        <search>\n          <query>index=_internal sourcetype=\"crowdstrike_fdr_ta*\" \"is processing SQS messages:\" sqs_msg_action IN (ingest, skip)\n| eval fdr_event_file = split(sqs_msg_fileList, \",\")\n| eval notification_time = _time\n| mvexpand fdr_event_file\n| eval s3_resource=\"s3://\"+sqs_msg_bucket+\"/\" + fdr_event_file\n| dedup s3_resource\n| fields notification_time s3_resource sqs_msg_action\n| join type=outer left=sqs right=ingest where sqs.s3_resource = ingest.events_source_file [search index=_internal sourcetype=\"crowdstrike_fdr_ta*\" \"has started ingestion: events_source_file=\"\n    | dedup events_source_file\n    | eval ingest_start_time = _time\n    | fields ingest_start_time events_source_file]\n| join type=outer left=sqs right=processed where sqs.sqs.s3_resource = processed.s3_resource [search index=_internal sourcetype=\"crowdstrike_fdr_ta*\" run_task_result=*\n    | rex field=_raw \"\\\"path\\\":\\s*\\\"(?&lt;path&gt;[^\\\"]+)\\\"\"\n    | rex field=_raw \"\\\"bucket\\\":\\s*\\\"(?&lt;bucket&gt;[^\\\"]+)\\\"\"\n    | eval s3_resource=\"s3://\" + bucket+ \"/\" + path\n    | eval finish_time = _time\n    | fields run_task_result s3_resource finish_time]\n| rename processed.finish_time as finish_time sqs.ingest.ingest_start_time as start_time sqs.sqs.notification_time as notification_time processed.run_task_result as ingest_result sqs.sqs_msg_action as action_on_notification ingest.s3_resource as start_resource\n| eval _time = strptime(coalesce(finish_time, start_time, notification_time), \"%s.%3N\")\n| fillnull value=\"missing\"\n| eval Ingested=if(ingest_result=\"done\", 1, 0)\n| eval Failed=if(ingest_result=\"failed\", 1, 0)\n| eval Skipped=if(action_on_notification=\"skip\", 1, 0)\n| eval InProgress=if(action_on_notification=\"ingest\" AND start_resource!=\"missing\" AND ingest_result=\"missing\", 1, 0)\n| eval Scheduled=if(action_on_notification=\"ingest\" AND start_resource=\"missing\" AND ingest_result=\"missing\", 1, 0)\n| timechart span=1h sum(Ingested) as \"Ingested\" sum(Failed) as \"Failed\" sum(InProgress) as \"In progress\" sum(Scheduled) as \"Scheduled\" sum(Skipped) as \"Skipped\"</query>\n          <earliest>-14d@d</earliest>\n          <latest>now</latest>\n          <sampleRatio>1</sampleRatio>\n        </search>\n        <option name=\"charting.axisTitleX.text\">Time</option>\n        <option name=\"charting.axisTitleX.visibility\">visible</option>\n        <option name=\"charting.axisTitleY.visibility\">visible</option>\n        <option name=\"charting.axisX.scale\">linear</option>\n        <option name=\"charting.axisY.scale\">linear</option>\n        <option name=\"charting.chart\">column</option>\n        <option name=\"charting.legend.placement\">top</option>\n      </chart>\n    </panel>\n    <panel>\n      <title>Event ingestion average delay</title>\n      <chart>\n        <search>\n          <query>index=* sourcetype=\"crowdstrike:*\" event_ingest_time=*\n| eval diff = event_ingest_time - _time\n| timechart span=1h avg(diff) AS \"Ingest Delay in Seconds\"</query>\n          <earliest>-14d@d</earliest>\n          <latest></latest>\n          <sampleRatio>1</sampleRatio>\n        </search>\n        <option name=\"charting.axisTitleX.text\">Time</option>\n        <option name=\"charting.axisTitleX.visibility\">visible</option>\n        <option name=\"charting.axisTitleY.visibility\">visible</option>\n        <option name=\"charting.axisX.scale\">linear</option>\n        <option name=\"charting.axisY.scale\">linear</option>\n        <option name=\"charting.chart\">column</option>\n        <option name=\"charting.legend.placement\">top</option>\n      </chart>\n    </panel>\n  </row>\n  <row>\n    <panel>\n      <title>Ingested vs expected (missing and duplicated events)</title>\n      <chart>\n        <search>\n          <query>index=* sourcetype=\"crowdstrike:*\" earliest=-2w | stats count by source\n| append\n    [search index=\"_internal\" \"INGEST |&lt; cs_input_stanza=\" cs_ingest_filter_matches=* earliest=-1w\n    | stats latest(_time) as ingest_time latest(cs_ingest_filter_matches) as cs_ingest_filter_matches by cs_ingest_file_path\n    | rename cs_ingest_file_path as source]\n| stats latest(ingest_time) as ingest_time sum(cs_ingest_filter_matches) as expected_count sum(count) as ingested_count by source\n| where isnotnull(ingest_time)\n| eval _time = strptime(ingest_time, \"%s.%3N\")\n| eval diff = tonumber(ingested_count)-tonumber(expected_count)\n| eval Missing = if(diff &lt; 0, diff, 0)\n| eval Duplicated = if(diff &gt; 0, diff, 0)\n| timechart span=1h sum(Duplicated) as Duplicated sum(Missing) as Missing</query>\n          <earliest>0</earliest>\n          <latest>now</latest>\n          <sampleRatio>1</sampleRatio>\n        </search>\n        <option name=\"charting.axisTitleX.text\">Time</option>\n        <option name=\"charting.axisTitleX.visibility\">visible</option>\n        <option name=\"charting.axisTitleY.visibility\">visible</option>\n        <option name=\"charting.axisX.scale\">linear</option>\n        <option name=\"charting.axisY.scale\">linear</option>\n        <option name=\"charting.chart\">column</option>\n        <option name=\"charting.legend.placement\">top</option>\n      </chart>\n    </panel>\n  </row>\n  <row>\n    <panel>\n      <title>Modular inputs ingest rates (MB/hour)</title>\n      <chart>\n        <search>\n          <query>index=\"_internal\" sourcetype=\"crowdstrike_fdr_ta*\" \"Sent to pipeline: cs_input_stanza=\"\n| eval cs_megabytes_sent = cs_bytes_sent/1024/1024\n| timechart span=1h sum(cs_megabytes_sent) by cs_input_stanza</query>\n          <earliest>-2d</earliest>\n          <latest>now</latest>\n          <sampleRatio>1</sampleRatio>\n        </search>\n        <option name=\"charting.axisTitleX.text\">Time</option>\n        <option name=\"charting.axisTitleX.visibility\">visible</option>\n        <option name=\"charting.axisTitleY.visibility\">visible</option>\n        <option name=\"charting.axisX.scale\">linear</option>\n        <option name=\"charting.axisY.scale\">linear</option>\n        <option name=\"charting.chart\">column</option>\n        <option name=\"charting.legend.placement\">top</option>\n      </chart>\n    </panel>\n    <panel>\n      <title>Modular inputs ingest rates (files/hour)</title>\n      <chart>\n        <search>\n          <query>index=\"_internal\" sourcetype=\"crowdstrike_fdr_ta*\" \"Sent to pipeline: cs_input_stanza=\"\n| timechart span=1h count by cs_input_stanza</query>\n          <earliest>-2d</earliest>\n          <latest>now</latest>\n          <sampleRatio>1</sampleRatio>\n        </search>\n        <option name=\"charting.axisTitleX.text\">Time</option>\n        <option name=\"charting.axisTitleX.visibility\">visible</option>\n        <option name=\"charting.axisTitleY.visibility\">visible</option>\n        <option name=\"charting.axisX.scale\">linear</option>\n        <option name=\"charting.axisY.scale\">linear</option>\n        <option name=\"charting.chart\">column</option>\n        <option name=\"charting.legend.placement\">top</option>\n      </chart>\n    </panel>\n    <panel>\n      <title>Modular inputs average batch processing time (in seconds)</title>\n      <chart>\n        <search>\n          <query>index=\"_internal\" sourcetype=\"crowdstrike_fdr_ta*\" \"BATCH processing summary: cs_input_stanza=\"\n| timechart span=1h avg(cs_batch_time_taken) as \"Processing time\"</query>\n          <earliest>-2d</earliest>\n          <latest>now</latest>\n          <sampleRatio>1</sampleRatio>\n        </search>\n        <option name=\"charting.axisTitleX.text\">Time</option>\n        <option name=\"charting.axisTitleX.visibility\">visible</option>\n        <option name=\"charting.axisTitleY.visibility\">visible</option>\n        <option name=\"charting.axisX.scale\">linear</option>\n        <option name=\"charting.axisY.scale\">linear</option>\n        <option name=\"charting.chart\">column</option>\n        <option name=\"charting.legend.placement\">top</option>\n      </chart>\n    </panel>\n  </row>\n</dashboard>",
"eai:type": "views",
"name": "troubleshooting",
"owner": "nobody",
"sharing": "global"
}
]
